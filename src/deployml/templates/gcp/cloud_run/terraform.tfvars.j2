project_id = "{{ project_id }}"
region = "{{ region }}"
zone = "{{ zone }}"
global_image = "gcr.io/{{ project_id }}/mlflow/mlflow:latest"
allow_public_access = true
auto_approve = false

# Cloud Run specific defaults
cpu_limit = "2000m"
memory_limit = "2Gi"
cpu_request = "1000m"
memory_request = "1Gi"
max_scale = 10
container_concurrency = 80

# Database defaults
db_type = "postgresql" 
db_user = "mlflow"      # Set to match cloud_sql_postgres module
db_password = ""        # Auto-generated
db_name = "mlflow"      # Set to match cloud_sql_postgres module
db_port = "5432"        

{% for stage in stack %}
  {% for stage_name, tool in stage.items() %}
    {% if stage_name == "artifact_tracking" %}
artifact_bucket = "{{ tool.params.get('artifact_bucket', '') }}"
    {% endif %}
    {% for key, value in tool.params.items() %}
      {% if key == "image" %}
{{ stage_name }}_{{ tool.name }}_image = "{{ value }}"
      {% elif key == "bucket_exists" %}
bucket_exists = {{ value | lower }}
      {% elif key == "backend_store_uri" %}
backend_store_uri = "{{ value }}"
      {% elif key not in ["cpu_limit", "memory_limit", "cpu_request", "memory_request", "max_scale", "container_concurrency", "artifact_bucket", "create_artifact_bucket"] %}
{{ key }} = "{{ value }}"
      {% endif %}
    {% endfor %}
  {% endfor %}
{% endfor %}

create_artifact_bucket = {{ create_artifact_bucket | lower }} 